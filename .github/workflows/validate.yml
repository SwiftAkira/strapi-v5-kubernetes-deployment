name: ğŸ§ª Validate Repository

on:
  pull_request:
    paths:
      - '*.sh'
      - 'strapi-v5-upgrade/**/*.sh'
      - '*.yaml'
      - '*.yml'
  push:
    branches: [main, master]
    paths:
      - '*.sh'
      - 'strapi-v5-upgrade/**/*.sh'
      - '*.yaml'
      - '*.yml'

jobs:
  validate-scripts:
    name: ğŸ“œ Validate Shell Scripts
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup shellcheck
      run: sudo apt-get update && sudo apt-get install -y shellcheck
      
    - name: ğŸ§ª Lint shell scripts
      run: |
        find . -name "*.sh" -exec shellcheck {} \;

  check-secrets:
    name: ğŸ” Check for Secrets
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” Scan for potential secrets
      run: |
        echo "Checking for potential secrets..."
        # Check that strapi-secrets.yaml only contains placeholder values
        if grep -q "742561979202\|dev-onair\|172\.16\.1\.152" *.yaml; then
          echo "âŒ Found non-generic values in YAML files!"
          echo "Please ensure all configurations use placeholder values."
          exit 1
        fi
        echo "âœ… No hardcoded secrets found"
