name: 🧪 Validate Repository

on:
  pull_request:
    paths:
      - '*.sh'
      - 'strapi-v5-upgrade/**/*.sh'
      - '*.yaml'
      - '*.yml'
  push:
    branches: [main, master]
    paths:
      - '*.sh'
      - 'strapi-v5-upgrade/**/*.sh'
      - '*.yaml'
      - '*.yml'

jobs:
  validate-scripts:
    name: 📜 Validate Shell Scripts
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
      
    - name: 🔧 Setup shellcheck
      run: sudo apt-get update && sudo apt-get install -y shellcheck
      
    - name: 🧪 Lint shell scripts
      run: |
        find . -name "*.sh" -exec shellcheck {} \;

  check-secrets:
    name: 🔐 Check for Secrets
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
      
    - name: 🔍 Scan for potential secrets
      run: |
        echo "Checking for potential secrets..."
        # Check that strapi-secrets.yaml only contains placeholder values
        if grep -q "742561979202\|dev-onair\|172\.16\.1\.152" *.yaml; then
          echo "❌ Found non-generic values in YAML files!"
          echo "Please ensure all configurations use placeholder values."
          exit 1
        fi
        echo "✅ No hardcoded secrets found"
